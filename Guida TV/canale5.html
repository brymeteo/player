<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guida TV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
      
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
       
    }

    /* Banner */
    #banner {
        background-color: #3498db;
        color: #fff;
        padding: 10px 20px;
        text-align: center;
        font-size: 20px;
        width: 100%;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 10;
    }

  #tv-guide {
    max-width: 1300px;
    margin-top: -100px;
    /* padding: 20px; */
    border-radius: 10px;
    overflow: hidden;
    width: 100%;
    position: relative;
    background: linear-gradient(359deg, rgb(255 255 255 / 0%) -0.02%, rgb(34 33 78 / 0%) 24.88%, rgb(21 10 35) 49.79%, rgb(32 34 64) 74.7%, rgb(67 80 123) 99.6%);
}

    /* Programmi */
    .program-item {
        padding: 30px;
        margin-bottom: 10px;
        background-color: #353c69;
        border-radius: 8px;
    }

    .program-item h3 {
        margin: 5px 0;
        color: #3498db;
       font-size: xx-large;

    }

    .program-item p {
        margin: 5px 0;
        color: #bbb;
        font-size: large;

    }

    .program-item .time {
        font-size: 17px;
        color: #1da676;
    }

    .program-item.now {
        background-color: #353c69eb; /* Evidenziato per il programma in onda */
    }

    .program-item img {
        max-width: 30%;
        border-radius: 8px;
        margin-top: 10px;
    }

    /* Progress bar */
    .progress-bar-container {
        margin-top: 20px;
        width: 100%;
       
    }

    
     progress {
    width: 100%;
    height: 20px;
    border-radius: 10px;
    background: linear-gradient(#ffffff42 , #353c69);
    overflow: hidden;
    position: relative;
   
    
}

    progress::-webkit-progress-value {
        background-color: #ffffffcc; /* Colore di avanzamento blu */border-radius: 10px;
    }

    progress::-moz-progress-bar {
        background-color: #3498db; /* Colore di avanzamento blu */
    }

    progress::-webkit-progress-bar {
        background-color: #ffffff42; /* Colore di sfondo (grigio scuro) */
    }

    #time-remaining {
        margin-top: 5px;
        font-size: 19px;
        color: #fff;
    }

    /* Icona del prossimo programma */
    .date-selector {
        position: absolute; /* Posizionamento assoluto rispetto al contenitore */
        right: 45px; /* Distanza dal bordo destro */
        top: 50%; /* Centrato verticalmente */
        transform: translateY(-50%); /* Allineamento perfetto al centro */
    }

    .date-selector img {
        cursor: pointer;
        width: 40px; /* Imposta una larghezza fissa per l'icona */
        height: 40px; /* Imposta un'altezza fissa per l'icona */
        transition: transform 0.3s ease; /* Aggiungi una transizione per un effetto al passaggio del mouse */
    }

    .date-selector img:hover {
        transform: scale(1.1); /* Effetto di ingrandimento al passaggio del mouse */
    }
</style>

</head>
<body>

    <div id="tv-guide">
        <div id="current-program" class="program-list">
            <!-- Mostra il programma in onda -->
        </div>
        <div class="date-selector">
            <img src="https://i.ibb.co/cQPLbg5/keyboard-right-arrow-button-1-icon-icons-com-72690.png" alt="Vedi il prossimo programma" class="next-program-icon" onclick="showNextProgram()">
        </div>
    </div>

    <script>
        let data = [];  // Dati EPG caricati da JSON
        let currentProgramIndex = 0;  // Indice del programma corrente
        let attemptCount = 0; // Conta il numero di tentativi per visualizzare i programmi successivi
        let progressInterval;  // Variabile per l'intervallo di aggiornamento della barra di avanzamento

        // Funzione per caricare i dati EPG da un file JSON esterno
        async function loadEPGData() {
            try {
                const url = "https://brymeteo.github.io/player/Guida%20TV/list.json"; // URL del JSON
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('Errore nel caricamento dei dati');
                }

                const epgData = await response.json();
                data = epgData.filter(channel => channel.name === 'Canale 5'); // Filtra solo Rai 1

                showCurrentProgram();

            } catch (error) {
                console.error('Errore:', error);
            }
        }

        // Funzione per visualizzare il programma in onda
        function showCurrentProgram() {
            const currentTime = new Date();
            const channel = data[0]; // Rai 1

            const currentProgram = channel.programs.find(program => currentTime >= new Date(program.start) && currentTime <= new Date(program.end));

            if (currentProgram) {
                const programList = document.getElementById('current-program');
                programList.innerHTML = `
                    <div class="program-item now">
                        <h3>${currentProgram.title}</h3>
                        <p>${currentProgram.description}</p>
                        <p class="time"><strong>Start:</strong> ${new Date(currentProgram.start).toLocaleString()} <br><strong>End:</strong> ${new Date(currentProgram.end).toLocaleString()}</p>
                        ${currentProgram.poster ? `<img src="${currentProgram.poster}" alt="${currentProgram.title} poster">` : `<p>Immagine non disponibile</p>`}
                        <div class="progress-bar-container">
                            <progress id="progress-bar" value="0" max="100"></progress>
                            <div id="time-remaining">Tempo rimanente: --</div>
                        </div>
                    </div>
                `;
                currentProgramIndex = channel.programs.indexOf(currentProgram) + 1; // Imposta l'indice del programma successivo
                updateProgressBar(currentProgram);  // Inizia a mostrare la barra di avanzamento
            }
        }

        // Funzione per aggiornare la barra di avanzamento
        function updateProgressBar(currentProgram) {
            const currentTime = new Date();
            const startTime = new Date(currentProgram.start);
            const endTime = new Date(currentProgram.end);
            const duration = endTime - startTime;  // Durata totale del programma
            const elapsed = currentTime - startTime;  // Tempo trascorso

            if (elapsed >= 0 && elapsed <= duration) {
                const progress = (elapsed / duration) * 100;
                const remainingTime = endTime - currentTime;
                const remainingMinutes = Math.ceil(remainingTime / (1000 * 60));  // Tempo rimanente in minuti

                document.getElementById('progress-bar').value = progress;
                document.getElementById('time-remaining').innerText = `Tempo rimanente: ${remainingMinutes} min`;
            }

            // Aggiorna la barra ogni secondo
            if (progressInterval) clearInterval(progressInterval);
            progressInterval = setInterval(() => updateProgressBar(currentProgram), 1000);
        }

        // Funzione per visualizzare il prossimo programma
        function showNextProgram() {
            const channel = data[0]; // Rai 1
            const programList = document.getElementById('current-program');

            // Limita a 2 tentativi
            if (attemptCount < 2) {
                if (currentProgramIndex < channel.programs.length) {
                    const nextProgram = channel.programs[currentProgramIndex];
                    programList.innerHTML = `
                        <div class="program-item">
                            <h3>${nextProgram.title}</h3>
                            <p>${nextProgram.description}</p>
                            <p class="time"><strong>Start:</strong> ${new Date(nextProgram.start).toLocaleString()} <br><strong>End:</strong> ${new Date(nextProgram.end).toLocaleString()}</p>
                            ${nextProgram.poster ? `<img src="${nextProgram.poster}" alt="${nextProgram.title} poster">` : `<p>Immagine non disponibile</p>`}
                            <div class="progress-bar-container">
                                <progress id="progress-bar" value="0" max="100"></progress>
                                <div id="time-remaining">Tempo rimanente: --</div>
                            </div>
                        </div>
                    `;
                    currentProgramIndex++; // Avanza all'indice successivo
                    attemptCount++; // Incrementa il numero di tentativi
                    clearInterval(progressInterval);  // Ferma la barra di avanzamento precedente
                } else {
                    programList.innerHTML = `<p>Non ci sono altri programmi disponibili.</p>`;
                }
            } 

            // Dopo 2 tentativi, torna al programma in onda
            if (attemptCount >= 2) {
                setTimeout(() => {
                    showCurrentProgram();
                    attemptCount = 0;  // Reset dei tentativi
                }, 5000);  // Attende 5 secondi prima di riprendere il programma in onda
            }
        }

        // Carica i dati EPG
        loadEPGData();
    </script>
</body>
</html>
